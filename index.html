<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TCX Treadmill Modifier</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üèÉ TCX Treadmill Modifier</h1>
        <p class="subtitle">Modify pace and incline for your treadmill runs</p>
      </header>

      <!-- File Upload Section -->
      <section class="upload-section" id="uploadSection">
        <div class="upload-box" id="uploadBox">
          <div class="upload-icon">üìÅ</div>
          <h2>Upload TCX File</h2>
          <p>Drag and drop your TCX file here or click to browse</p>
          <input type="file" id="fileInput" accept=".tcx" hidden />
          <button class="btn-primary">Choose File</button>
        </div>
      </section>

      <!-- Main Content (hidden until file is loaded) -->
      <div id="mainContent" class="hidden">
        <!-- File Info -->
        <section class="file-info">
          <div class="info-card">
            <h3 id="fileName">File: -</h3>
            <p id="fileStats">Laps: - | Total Time: -</p>
          </div>
          <button class="btn-secondary" onclick="resetApp()">
            Upload New File
          </button>
        </section>

        <!-- Lap Data Table -->
        <section class="table-section">
          <div class="section-header">
            <h2>Lap Data</h2>
            <button class="btn-secondary btn-sm" onclick="toggleBulkEdit()">
              ‚ö° Bulk Edit
            </button>
          </div>
          <p class="table-hint">
            üí° Click on speed, distance, incline or elevation values to edit
            them
          </p>

          <!-- Bulk Edit Section -->
          <div id="bulkEditSection" class="bulk-edit-section hidden">
            <div class="bulk-edit-card">
              <div class="bulk-header">
                <h3>‚ö° Bulk Edit Laps</h3>
                <button class="btn-close" onclick="toggleBulkEdit()">√ó</button>
              </div>

              <div class="bulk-content">
                <!-- Selection Column -->
                <div class="bulk-col">
                  <h4>1. Select Laps</h4>
                  <div class="quick-filters">
                    <button class="filter-btn" onclick="selectLaps('all')">
                      All
                    </button>
                    <button class="filter-btn" onclick="selectLaps('odd')">
                      Odd
                    </button>
                    <button class="filter-btn" onclick="selectLaps('even')">
                      Even
                    </button>
                    <button class="filter-btn" onclick="selectLaps('none')">
                      Clear
                    </button>
                  </div>
                  <div class="selection-input-wrapper">
                    <label for="lapSelection">Selected Laps:</label>
                    <input
                      type="text"
                      id="lapSelection"
                      placeholder="e.g. 1-5, 8, 10"
                    />
                    <p class="hint">
                      Type specific numbers (e.g. 1, 3, 5) or ranges (e.g. 1-10)
                    </p>
                  </div>
                </div>

                <!-- Action Column -->
                <div class="bulk-col">
                  <h4>2. Set Values</h4>
                  <div class="action-grid-rows">
                    <!-- Speed / Distance Pair -->
                    <div class="action-pair-container">
                      <div class="action-pair">
                        <div class="action-group">
                          <label>Speed (km/h)</label>
                          <input
                            type="number"
                            id="bulkSpeedValue"
                            step="0.1"
                            placeholder="-"
                            oninput="handleBulkInput('speed')"
                          />
                        </div>
                        <div class="pair-separator">or</div>
                        <div class="action-group">
                          <label>Distance (km)</label>
                          <input
                            type="number"
                            id="bulkDistanceValue"
                            step="0.01"
                            placeholder="-"
                            oninput="handleBulkInput('distance')"
                          />
                        </div>
                      </div>
                    </div>

                    <!-- Incline / Elevation Pair -->
                    <div class="action-pair-container">
                      <div class="action-pair">
                        <div class="action-group">
                          <label>Incline (%)</label>
                          <input
                            type="number"
                            id="bulkInclineValue"
                            step="0.1"
                            placeholder="-"
                            oninput="handleBulkInput('incline')"
                          />
                        </div>
                        <div class="pair-separator">or</div>
                        <div class="action-group">
                          <label>Elevation (m)</label>
                          <input
                            type="number"
                            id="bulkElevationValue"
                            step="0.1"
                            placeholder="-"
                            oninput="handleBulkInput('elevation')"
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="bulk-actions">
                    <button
                      class="btn-primary full-width"
                      onclick="applyBulkEdit()"
                    >
                      Apply Changes
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="table-container">
            <table id="lapTable">
              <thead>
                <tr>
                  <th>Lap</th>
                  <th>Time (mm:ss)</th>
                  <th>Speed (km/h)</th>
                  <th>Distance (km)</th>
                  <th>Incline (%)</th>
                  <th>Elevation (m)</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="lapTableBody">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Results Summary Section -->
        <section class="summary-section">
          <h2>Results Summary</h2>
          <div class="summary-cards">
            <div class="summary-card">
              <span class="summary-label">Total Time</span>
              <span class="summary-value" id="totalTimeValue">-</span>
            </div>
            <div class="summary-card">
              <span class="summary-label">Average Speed</span>
              <span class="summary-value" id="avgSpeedValue">-</span>
            </div>
            <div class="summary-card">
              <span class="summary-label">Total Distance</span>
              <span class="summary-value" id="totalDistanceValue">-</span>
            </div>
            <div class="summary-card">
              <span class="summary-label">Total Climb</span>
              <span class="summary-value" id="totalClimbValue">-</span>
            </div>
          </div>
        </section>

        <!-- Visualization Section -->
        <section class="charts-section">
          <h2>Visualization</h2>
          <div class="charts-container">
            <div class="chart-wrapper">
              <h3>Altitude Profile</h3>
              <canvas id="altitudeChart"></canvas>
            </div>
            <div class="chart-wrapper">
              <h3>Speed Comparison</h3>
              <canvas id="speedChart"></canvas>
            </div>
          </div>
        </section>

        <!-- Action Buttons -->
        <section class="action-section">
          <button
            class="btn-correct"
            id="correctBtn"
            onclick="generateCorrectedFile()"
          >
            ‚úÖ Correct & Download TCX
          </button>
        </section>
      </div>
    </div>

    <footer>
      <p>Built for treadmill runners | Modify your TCX files with ease</p>
    </footer>

    <script src="app.js"></script>
  </body>
</html>
